<div role="tabpanel" class="tab-pane active" id="base" aria-labelledby="base-tab">
    <div class="data-tab">
        <a class="btn btn-default disabled" data-href="#base1">工商信息</a>
        <!--<a class="btn btn-default disabled" href="#base2">企业人员董监高信息</a>-->
        <!--<a class="btn btn-default disabled" href="#base3">企业对外投资</a>-->
        <!--<a class="btn btn-default disabled" href="#base4">投资图谱</a>-->
        <!--<a class="btn btn-default disabled" href="#base5">疑似关系</a>-->
        <!--<a class="btn btn-default disabled" href="#base6">股权穿透图</a>-->
        <!--<a class="btn btn-default disabled" href="#base7">企业图谱</a>-->
        <a class="btn btn-default disabled" data-href="#base8">股东信息</a>
        <a class="btn btn-default disabled" data-href="#base14">控股公司</a>
        <a class="btn btn-default disabled" data-href="#base9">主要人员</a>
        <a class="btn btn-default disabled" data-href="#base10">分支机构</a>
        <a class="btn btn-default disabled" data-href="#base11">变更信息</a>
        <a class="btn btn-default disabled" data-href="#base12">联系信息</a>
        <!--<a class="btn btn-default disabled" data-href="#base13">行业信息</a>-->
    </div>
    <div class="panel-qcc" id="base1">
        <div class="panel-qcc-heading">工商信息</div>
        <div class="panel-qcc-body" id="base1-body">
        </div>
    </div>
    <div class="panel-qcc" id="base8">
        <div class="panel-qcc-heading">股东信息 <b id="base8-count">0</b></div>
        <div class="panel-qcc-body" id="base8-body">
        </div>
    </div>
    <div class="panel-qcc" id="base14">
        <div class="panel-qcc-heading">控股公司 <b id="base14-count">0</b></div>
        <div class="panel-qcc-body" id="base14-body">
        </div>
    </div>
    <div class="panel-qcc" id="base9">
        <div class="panel-qcc-heading">主要人员 <b id="base9-count">0</b></div>
        <div class="panel-qcc-body" id="base9-body">
        </div>
    </div>
    <div class="panel-qcc" id="base10">
        <div class="panel-qcc-heading">分支机构 <b id="base10-count">0</b></div>
        <div class="panel-qcc-body" id="base10-body">
        </div>
    </div>
    <div class="panel-qcc" id="base11">
        <div class="panel-qcc-heading">变更信息 <b id="base11-count">0</b></div>
        <div class="panel-qcc-body" id="base11-body">
        </div>
    </div>
    <div class="panel-qcc" id="base12">
        <div class="panel-qcc-heading">联系信息</div>
        <div class="panel-qcc-body" id="base12-body">
        </div>
    </div>
    <!--<div class="panel-qcc" id="base13">-->
        <!--<div class="panel-qcc-heading">行业信息</div>-->
        <!--<div class="panel-qcc-body" id="base13-body">-->
        <!--</div>-->
    <!--</div>-->
</div>
<style>
    .path {
        display: inline-block;
        width: 84px;
        height: 26px;
        background: url('/static/htmlImage/line_arrow.png') no-repeat right bottom;
        background-size: 75px 8px;
        padding-bottom: 10px;
        font-size: 12px;
        color: #128bed;
        text-align: center;
        position: relative;
        top: -9px;
        margin-right: 6px;
    }
</style>
<script type="text/html" id="toolbar">
    <div class="layui-toolbar">
        <a href="javascript:;" class="showStockRelationInfo" data-name="{{d.Name}}">{{d.Name}}</a>
    </div>
</script>
<!--cfc-->
<style>
ins { background-color: #FEC8C8; text-decoration: none; } del { color: #999; background-color: #FEC8C8; } .text { float:left; width: 30%; border: 1px solid blue; margin: 10px; }
</style>

<!--投资路径模板-->
<script type="text/html" id="paths">
    {{#  layui.each(d.Paths, function(index, item){ }}
        <b>路径 {{index + 1 }} (占比约 {{d.PercentTotal}}):</b>
        <br/>
            {{d.Name}}
            {{#  layui.each(item, function(i, t){ }}
                <span class="path">{{t.PercentTotal}}</span>
            {{t.Name}}
            {{# }) }}
        <br/>
    {{# }) }}
</script>
<script type="text/html" id="test">
    <table class="table table-bordered qcc-table-1" border="1">
        <tbody>
        {{each data value}}
        <tr>
            {{each value val index}}
            <td class="col-xs-1 text-right">
                {{index + 1}}
            </td>
            <td class=" {{value[index+1] ? col-xs-5 : col-xs-11}} type-info">
                {{val}}
            </td>
            {{/each}}
        </tr>
        {{/each}}
        </tbody>
    </table>

</script>
<!--// 对比差异-->
<script src="/static/vendor/htmldiff.js"></script>
<script src="/htmlsrc/qichacha/tmpl/eci/qccTable.js"></script>
<script>
    $.ajax({
        url: remoteApi.qccECIGetDetailsByName+"?fullName="+COMPANY_NAME,
        success: function (res) {
            var data = res.data || {};
            COMPANY_KEY_NO = data.KeyNo;
            if(COMPANY_KEY_NO){
                keyNoPromise.resolve(COMPANY_KEY_NO);
                $("a[data-href='#base1']").removeClass("disabled");
            }else{
                keyNoPromise.reject("KeyNo获取失败！");
            }
            if(data.IsOnStock){
                data.IsOnStock = data.IsOnStock == "0" ? "未上市" : "上市";
            }
            data.SubIndustry = (data.Industry || {}).SubIndustry || "";
            // if(data.Industry.SubIndustry){}

            $("#base1-body").html(
                qccTableRender({
                    cols:[
                        {title:"法人名",field:"OperName"},
                        {title:"公司名称",field:"Name"},
                        {title:"注册资本",field:"RegistCapi"},
                        {title:"实缴资本",field:"RecCap"},
                        {title:"企业状态",field:"Status"},
                        {title:"成立日期",field:"StartDate"},
                        {title:"社会统一信用代码",field:"CreditCode"},
                        // 纳税人识别号
                        {title:"注册号",field:"No"},
                        {title:"组织机构代码",field:"OrgNo"},
                        {title:"企业类型",field:"EconKind"},
                        {title:"所属行业",field:"SubIndustry"},
                        // 核准日期
                        {title:"登记机关",field:"BelongOrg"},
                        {title:"省份",field:"Province"},
                        // {title:"吊销日期",field:"EndDate"},
                        // {title:"更新日期",field:"UpdatedDate"},
                        {title:"营业开始日期",field:"TermStart"},
                        {title:"营业结束日期",field:"TeamEnd"},
                        {title:"核准日期",field:"CheckDate"},
                        // {title:"是否上市",field:"IsOnStock"},
                        // {title:"上市公司代码",field:"StockNumber"},
                        // {title:"上市类型",field:"StockType"},
                        {title:"地址",field:"Address", spec: true},
                        {title:"经营范围",field:"Scope", spec: true}
                    ],
                    data: data
                })
            );

            // 股东信息
            if(data.Partners && data.Partners.length > 0){
                $("#base8-count").html(data.Partners.length);
                $("a[data-href='#base8']").removeClass("disabled");
            }
            laytableRender({
                page: false,
                id: "base8-body",
                elem: "#base8-body",
                cols: [
                    [
                        BOOTSTRAP_INDEX_FILED,
                        {title:"股东",field:"StockName"},
                        // {title:"股东类型",field:"StockType"},
                        {title:"持股比例",field:"StockPercent"},
                        {title:"认缴出资额",field:"ShouldCapi"},
                        {title:"认缴出资时间",field:"ShoudDate"},
                        // {title:"认缴出资方式",field:"InvestType"},
                        // {title:"实际出资方式",field:"InvestName"},
                        // {title:"实缴出资额",field:"RealCapi"},
                        // {title:"实缴时间",field:"CapiDate"}
                    ]
                ],
                data: data.Partners || []
            });

            // 主要人员
            if(data.Employees && data.Employees.length > 0){
                $("#base9-count").html(data.Employees.length);
                $("a[data-href='#base9']").removeClass("disabled");
            }
            laytableRender({
                page: false,
                id: "base9-body",
                elem: "#base9-body",
                cols:[
                    [
                        BOOTSTRAP_INDEX_FILED,
                        { title:'姓名', templet: "#toolbar", setWidth: 580},
                        {title:"职务",field:"Job"}
                    ]
                ],
                data: data.Employees || []
            });
            $(document).on("click", ".showStockRelationInfo", function () {
                var name = $(this).data("name");
                addNavTab("StockRelationInfo"+COMPANY_NAME+name, "企业人员董监高信息-"+name, "/htmlsrc/qichacha/CIAEmployee/GetStockRelationInfo.html?fullName="+COMPANY_NAME+"&name="+name);
                return false;
            });

            // 分支机构
            if(data.Branches && data.Branches.length > 0){
                $("#base10-count").html(data.Branches.length);
                $("a[data-href='#base10']").removeClass("disabled");
                var branches = [];
                var dataBranches = data.Branches;
                while((dataBranches || []).length > 0){
                    branches.push([
                        dataBranches.shift()["Name"],
                        dataBranches.shift()["Name"]
                    ]);
                }
                $("#base10-body").html(
                    template('test', {
                        data: branches
                    })
                );
            }
            // 变更历史
            if(data.ChangeRecords && data.ChangeRecords.length > 0){
                data.ChangeRecords.forEach(function (item) {
                    item["ChangeDate"] = subDateStr(item.ChangeDate);
                    var a = getHTMLDiff(item["BeforeContent"] || "", item["AfterContent"]);
                    var b = getHTMLDiff(item["AfterContent"] || "", item["BeforeContent"]);
                    item["AfterContent"] = a.replace(/<del(.|\n)*?del>/gmi,"");
                    item["BeforeContent"] = b.replace(/<del(.|\n)*?del>/gmi,"");
                });
                $("#base11-count").html(data.ChangeRecords.length);
                $("a[data-href='#base11']").removeClass("disabled");
            }
            laytableRender({
                id: "base11-body",
                elem: "#base11-body",
                cols:[
                    [
                        BOOTSTRAP_INDEX_FILED,
                        {title:"变更日期",field:"ChangeDate", setWidth: 90},
                        {title:"变更事项",field:"ProjectName"},
                        {title:"变更前内容",field:"BeforeContent"},
                        {title:"变更后内容",field:"AfterContent"}
                    ]
                ],
                data: data.ChangeRecords || [],
                onData:function () {
                    scrollToElm("base11");
                }
            });

            // 联系信息
            var contactInfo = data.ContactInfo || {};
            var contactInfoIsEmpty = true;
            // 判断数据object数据是否为空
            for (var key in contactInfo){
                if(contactInfo.hasOwnProperty(key) && contactInfo[key]){
                    contactInfoIsEmpty = false;
                    break;
                }
            }
            if(contactInfoIsEmpty === false){
                $("a[data-href='#base12']").removeClass("disabled");
            }
            $("#base12-body").html(
                qccTableRender({
                    cols:{
                        data: [
                            {title:"联系电话",field:"PhoneNumber"},
                            {title:"联系邮箱",field:"Email"}
                        ],
                        WebSite: [
                            {title:"网站名称",field:"Name"},
                            {title:"网站地址",field:"Url"}
                        ]
                    },
                    data: contactInfo
                })
            );

            // 行业信息
            // if($.isEmptyObject(data.Industry) === false){
            //     $("a[data-href='#base13']").removeClass("disabled");
            // }
            // $("#base13-body").html(
            //     qccTableRender({
            //         cols:[
            //             {title:"行业门类code",field:"IndustryCode"},
            //             {title:"行业门类描述",field:"Industry"},
            //             {title:"行业大类code",field:"SubIndustryCode"},
            //             {title:"行业大类描述",field:"SubIndustry"},
            //             {title:"行业中类code",field:"MiddleCategoryCode"},
            //             {title:"行业中类描述",field:"MiddleCategory"},
            //             {title:"行业小类code",field:"SmallCategoryCode"},
            //             {title:"行业小类描述",field:"SmallCategory"}
            //         ],
            //         data: data.Industry || {}
            //     })
            // )
        }
    });

    laytableRender({
        id: "base14-body",
        title: "控股公司",
        url: remoteApi.qccHoldingCompanyGetHoldingCompany+"?fullName="+COMPANY_NAME,
        cols: [
            [
                BOOTSTRAP_INDEX_FILED,
                {title:"控股企业名称", field:"Name", setWidth: 250},
                {title:"投资比例", field:"PercentTotal"},
                {title:"投资链", field:"Paths", templet: "#paths"}
            ]
        ],
        onData:function (data) {
            fixOnDataLoad("base14", data);
        }
    });

</script>
