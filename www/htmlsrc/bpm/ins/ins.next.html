<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>转交下一步</title>
    <!--#include file="/htmlsrc/header.html" -->
    <link rel="stylesheet" href="../../../static/bpm/jquery.tags-revisited.css">
    <link rel="stylesheet" href="../lib/css/ins.css">
    <link rel="stylesheet" href="../lib/font/css/font-awesome.min.css">
    <style>
        .checked{
            color: #0e90d2;
        }
        .fa-bell,.fa-envelope{
            cursor: pointer;
        }
        .fa{
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="work-prcs-title" id="op_user_show_info" style="margin:5px;margin-bottom: 10px;font-weight: normal;border-radius: 4px;-webkit-border-radius: 4px;margin-top: 10px">
        当前步骤为第<font color="red">几</font>步[节点名]
        <font color="red">
            <div self_type="self" style="display:inline;">处理人</div>
            <div style="display:inline;">流程状态 </div>
        </font>
    </div>

    <div style="margin:5px;" id="work-choose-next">
        <div class="work-prcs-title">请选择下一步骤</div>
        <table width="100%">
            <tr>
                <td width="150">
                    <ul id="selectTaskName" style="margin-left: 10px">
                        <li class='selectedCss'>节点名</li>
                        <li>节点2</li>
                    </ul>
                </td>
                <td>
                    <div style="margin-left: 10px">

                        <button id="chooseUser" class="btn btn-primary">选择人员</button>
                        <div id="mainUser" class="tagsinput" style="width: auto; min-height: auto; height: auto;">主办人
                        </div>
                    </div>
                </td>
            </tr>
        </table>

        <!--<div style="display: flex; flex-direction: row">-->
            <!--<ul id="selectTaskName" style="width: 150px;">-->
            <!--<li class='selectedCss'>节点名</li>-->
            <!--<li>节点2</li>-->
            <!--</ul>-->
            <!--<div style="flex: 1;">-->
                <!--<button id="chooseUser" class="btn btn-primary">选择人员</button>-->
                <!--<div id="mainUser" class="tagsinput" style="width: auto; min-height: auto; height: auto;">主办人-->
                <!--</div>-->
            <!--</div>-->
            <!--<div style="flex: 2; background: pink;">12332131312312</div>-->
        <!--</div>-->

        <!--<div style="position: relative;">-->
            <!--<div style="margin: 15px" class="work-main-left">-->
                <!--<ul id="selectTaskName">-->
                    <!--<li class='selectedCss'>节点名</li>-->
                    <!--<li>节点2</li>-->
                <!--</ul>-->
                <!--&lt;!&ndash;<input type="checkbox" checked>节点&ndash;&gt;-->
            <!--</div>-->
            <!--<div class="work-prcs-content clearfix" class="work-main-right" style="position: absolute;left: 150px;top: 0;right: 0;">-->
                <!--&lt;!&ndash;<div id="step"></div>&ndash;&gt;-->
                <!--<button id="chooseUser" class="btn btn-primary">选择人员</button>-->
                <!--<div id="mainUser" class="tagsinput" style="width: auto; min-height: auto; height: auto;">主办人-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->

    </div>
    <div style="margin:5px;border: 1px solid #d0d0d0">
        <div class="work-msg-title">向以下人员发送事务提醒消息</div>
        <div class="work-msg-content" style="display: block;">
            <div class="clearfix">
                <div class="work-msg-op-title">下一步骤：
                    <i class="fa fa-bell checked" aria-hidden="true" title="发送站内信"></i>
                    <i class="fa fa-envelope" aria-hidden="true" title="发送短信"></i>
                </div>
                <div class="work-msg-op-title">发起人：
                    <i class="fa fa-bell" aria-hidden="true" title="发送站内信"></i>
                    <i class="fa fa-envelope" aria-hidden="true" title="发送短信"></i>
                </div>
                <div class="work-msg-op-title">全部经办人：
                    <i class="fa fa-bell" aria-hidden="true" title="发送站内信"></i>
                    <i class="fa fa-envelope" aria-hidden="true" title="发送短信"></i>
                </div>
            </div>
        </div>
        <div class="clearfix" style="margin-left: 15px">
            提醒指定步骤经办人：
            <button id="chooseMsg" class="btn btn-primary">选择人员</button>
            <div id="msgUser" class="tagsinput" style="width: auto; min-height: auto; height: auto;">
            </div>
        </div>
        <div class="work-msg-sms-block">
            <label for="modelName" class="col-xs-3 text-left">
                提醒内容：
            </label>
            <div class="col-xs-8" style="padding-right: 15px;
                        padding-left: 15px; max-width:400px">
                <input type="text" class="form-control input-sm" id="modelName" name="modelName" value="您有新的工作需要办理">

            </div>
        </div>
    </div>
    <div style="text-align: center; padding-top: 20px;">
        <a href="javascript:;" id="submit">确定</a>
    </div>

    <!--<div id="content">-->
        <!--<div style="width: 500px;margin: 0 auto;">-->
            <!--<ul id="ulist" style="height: 200px; overflow: auto;margin: 0 auto;">-->
            <!--</ul>-->
            <!--<div style="text-align: center; padding-top: 20px;">-->
                <!--<a href="javascript:;" id="submit">确定</a>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
</body>
</html>
<script>
    var id = getParam("id");
    window.userId = null;
    window.userName = null;
    window.msgUser = {};

    var submitFn = function(){
        submit();
    }

    $("#submit").unbind("click",submitFn).bind("click",submitFn);

    function submit() {
        var person=$('input[name="person"]:checked').val();
        $.ajax({
            url: "/api/bpm/workflow/nextApprover",
            type:"post",
            headers:{
                "Content-Type": "application/json"
            },
            dataType:"json",
            data: JSON.stringify({
                id: id,
                nextUid: person
            }),
            success: function (msg) {
                if(!msg.success){
                    alert("提交失败");
                }
                window.opener.layer.msg("提交成功！")
                window.opener.load("deal", id);
                opener.type = "deal";
                opener.id = id;
                window.opener.scrollTo(0,0);
                window.close();
            }
            // complete: function () {
            //     layer.close
            // }
        })
    }

    $("#chooseUser").click(function () {
        var opener = window.open("./choose.html?id=" + id, "choosepersons", "top=100, left=100, width=500, height=300")
        opener.onload = function () {
            var _$ = document.querySelector.bind(opener.document);
            _$('#submit').onclick = function (e) {
                $("#mainUser").append("<span id='"+window.userId+"' class='tag'><span class='tag-text'>"+window.userId+"</span><button class='tag-remove' id='remove'></button></span>");
            }
        }
    })

    $("#chooseMsg").click(function () {
        var opener = window.open("./msg.choose.html?id=" + id, "msgchoosepersons", "top=100, left=100, width=500, height=300")
        opener.onload = function () {
            var _$ = document.querySelector.bind(opener.document);
            _$('#submit').onclick = function (e) {
                for(var i in window.msgUser){
                    alert(window.msgUser[i])
                }

                $("#msgUser").append("<span id='"+window.msgUser+"' class='tag'><span class='tag-text'>"+window.userId+"</span><button class='tag-remove' id='remove'></button></span>");
            }
        }
    });

    $("#mainUser").on("click",".tag-remove",function(){
        $(this).parent().remove();
    });

    $(".fa-bell,.fa-envelope").click(function () {
        $(this).toggleClass("checked")
    });

    $("#selectTaskName li").click(function() {
        $(this).siblings('li').removeClass('selectedCss');  		// 删除其他兄弟元素的样式
        $(this).addClass('selectedCss');
    });

</script>